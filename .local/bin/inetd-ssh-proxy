#!/bin/bash
HOST=$1
PORT=$2

if ! nc -zw1 localhost ${PORT}; then 
    if ssh -O check ${HOST}; then
        ssh -O forward -D ${PORT} ${HOST}
    else
        ssh -Nn -o ExitOnForwardFailure=yes -D ${PORT} ${HOST}
    fi
fi

nc -w3 localhost ${PORT}
