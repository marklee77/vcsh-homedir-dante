#!/bin/bash
HOST=$1
PORT=$2
if ! nc -zw1 localhost ${PORT}; then 
    if ! ssh -O check ${HOST}; then
        ssh -MNn -o ExitOnForwardFailure=yes ${HOST}
    fi
    ssh -O forward -D ${PORT} ${HOST}
fi
nc -w3 localhost ${PORT}
